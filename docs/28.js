"use strict";(self.webpackChunkpk_connect=self.webpackChunkpk_connect||[]).push([[28],{28:(e,t,n)=>{n.r(t),n.d(t,{bootstrap:()=>b,default:()=>v,mount:()=>S,unmount:()=>y});var o=n(861),c=n(885),s=n(757),a=n.n(s),r=n(271),i=n.n(r),u=n(650),l=n.n(u),h=n(577),d=n(788),p=n.n(d),k=(n(918),n(191)),m=n.n(k),f=n(566);function v(){var e=localStorage.getItem("token"),t=(0,r.useState)(e&&JSON.parse(e).value),n=(0,c.Z)(t,2),s=n[0],u=n[1],l=!1;return(0,r.useEffect)((0,o.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,fetch("https://pk-center.herokuapp.com/auth/reconnect",{method:"POST",headers:{Authorization:"Bearer ".concat(s)}}).then((function(e){if(e.status>=400&&e.status<600)throw new Error("Bad response from server");return f.default.setUser(m()(s)),e})).catch((function(e){localStorage.removeItem("token"),u(null)}));case 4:case"end":return e.stop()}}),e)}))),[]),i().createElement(i().Fragment,null,s&&i().createElement("div",{className:"pkc-status"},"connected"),!s&&i().createElement("div",{className:"pkc-modal"},i().createElement("div",{className:"pkc-modal-overlay"}),i().createElement("div",{className:"pkc-modal-content"},i().createElement("button",{onClick:function(){l||(l=!0,fetch("https://pk-center.herokuapp.com/auth/guest",{method:"POST"}).then((function(e){return e.json()})).then((function(e){localStorage.setItem("token",JSON.stringify({value:e.access_token})),u(e.access_token),f.default.setUser(m()(e.access_token))})).finally((function(){l=!1})))}},"Play as guest"),i().createElement("button",{onClick:function(){location.href="https://pk.land/#/account/login"}},"Login PK account"))))}(0,h.Z)({seed:"pk-connect",productionPrefix:"pk-connect"});var g=p()({React:i(),ReactDOM:l(),rootComponent:v,errorBoundary:function(e,t,n){return i().createElement("div",null,"This renders when a catastrophic error occurs")}}),b=g.bootstrap,S=g.mount,y=g.unmount},566:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var o=n(671),c=n(144),s=n(942),a=n(213),r=n.n(a),i=n(529);const u=new(function(){function e(){(0,o.Z)(this,e),(0,s.Z)(this,"isConnecting",!1),(0,s.Z)(this,"socket",null),(0,s.Z)(this,"user",{username:""}),(0,s.Z)(this,"isAuthenticatedSubject",new i.BehaviorSubject(!1)),(0,s.Z)(this,"isAuthenticated$",isAuthenticatedSubject.asObservable())}return(0,c.Z)(e,[{key:"isConnected",value:function(){return this.socket&&this.socket.connected||!1}},{key:"isAuthenticated",value:function(){return this.user&&this.user.username}},{key:"logout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{redirectToHomepage:!0};localStorage.removeItem("token"),this.user={},this.isAuthenticatedSubject.next(!1),e.redirectToHomepage&&(location.href="/")}},{key:"setUser",value:function(e){this.user=e,this.isAuthenticatedSubject.next(!0),this.socket&&this.socket.emit("updateUserInfo",{username:e.username})}},{key:"init",value:function(e){if(!this.isConnecting&&!this.socket){var t=localStorage.getItem("token"),n=t&&JSON.parse(t).value;this.socket=r()(e,{withCredentials:!0,transportOptions:{polling:{extraHeaders:{Authorization:"Bearer ".concat(n)}}}}),this.isConnecting=!0,this.socket.on("connect",this.onConnect)}}},{key:"onConnect",value:function(e){this.isConnecting=!1,console.log("connected")}}]),e}())},279:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(81),c=n.n(o),s=n(645),a=n.n(s)()(c());a.push([e.id,".pkc-status {\n  color: lime;\n}\n.pkc-modal {\n  position: fixed;\n  z-index: 500;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100vh;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.pkc-modal-overlay {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 0, 0, 0.7);\n}\n.pkc-modal-content {\n  z-index: 1;\n  width: 300px;\n  height: 200px;\n}\n",""]);const r=a},918:(e,t,n)=>{var o=n(379),c=n.n(o),s=n(279);c()(s.Z,{insert:"head",singleton:!1}),s.Z.locals}}]);