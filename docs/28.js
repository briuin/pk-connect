"use strict";(self.webpackChunkpk_connect=self.webpackChunkpk_connect||[]).push([[28],{28:(e,n,t)=>{t.r(n),t.d(n,{bootstrap:()=>C,default:()=>g,mount:()=>w,unmount:()=>y});var o=t(861),c=t(885),a=t(757),r=t.n(a),s=t(271),i=t.n(s),u=t(650),l=t.n(u),h=t(577),p=t(788),d=t.n(p),k=(t(918),t(191)),f=t.n(k),m=t(566);function g(){var e=localStorage.getItem("token"),n=(0,s.useState)(e&&JSON.parse(e).value),t=(0,c.Z)(n,2),a=t[0],u=t[1],l=!1;return(0,s.useEffect)((0,o.Z)(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,fetch("https://pk-center.herokuapp.com/auth/reconnect",{method:"POST",headers:{Authorization:"Bearer ".concat(a)}}).then((function(e){if(e.status>=400&&e.status<600)throw new Error("Bad response from server");return m.default.setUser(f()(a)),e})).catch((function(e){localStorage.removeItem("token"),u(null)}));case 4:case"end":return e.stop()}}),e)}))),[]),i().createElement(i().Fragment,null,a&&i().createElement("div",{className:"pkc-status"},"connected"),!a&&i().createElement("div",{className:"pkc-modal"},i().createElement("div",{className:"pkc-modal-overlay"}),i().createElement("div",{className:"pkc-modal-content"},i().createElement("button",{onClick:function(){l||(l=!0,fetch("https://pk-center.herokuapp.com/auth/guest",{method:"POST"}).then((function(e){return e.json()})).then((function(e){localStorage.setItem("token",JSON.stringify({value:e.access_token})),u(e.access_token),m.default.setUser(f()(e.access_token))})).finally((function(){l=!1})))}},"Play as guest"),i().createElement("button",{onClick:function(){location.href="https://pk.land/#/account/login"}},"Login PK account"))))}(0,h.Z)({seed:"pk-connect",productionPrefix:"pk-connect"});var v=d()({React:i(),ReactDOM:l(),rootComponent:g,errorBoundary:function(e,n,t){return i().createElement("div",null,"This renders when a catastrophic error occurs")}}),C=v.bootstrap,w=v.mount,y=v.unmount},566:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var o=t(671),c=t(144),a=t(942),r=t(213),s=t.n(r);const i=new(function(){function e(){(0,o.Z)(this,e),(0,a.Z)(this,"isConnecting",!1),(0,a.Z)(this,"socket",null),(0,a.Z)(this,"user",{username:""})}return(0,c.Z)(e,[{key:"isConnected",value:function(){return this.socket&&this.socket.connected||!1}},{key:"setUser",value:function(e){this.user=e}},{key:"init",value:function(e){if(!this.isConnecting&&!this.socket){var n=localStorage.getItem("token"),t=n&&JSON.parse(n).value;this.socket=s()(e,{withCredentials:!0,transportOptions:{polling:{extraHeaders:{Authorization:"Bearer ".concat(t)}}}}),this.isConnecting=!0,this.socket.on("connect",this.onConnect)}}},{key:"onConnect",value:function(e){this.isConnecting=!1,console.log("connected")}}]),e}())},279:(e,n,t)=>{t.d(n,{Z:()=>s});var o=t(81),c=t.n(o),a=t(645),r=t.n(a)()(c());r.push([e.id,".pkc-status {\n  color: lime;\n}\n.pkc-modal {\n  position: fixed;\n  z-index: 500;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100vh;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.pkc-modal-overlay {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 0, 0, 0.7);\n}\n.pkc-modal-content {\n  z-index: 1;\n  width: 300px;\n  height: 200px;\n}\n",""]);const s=r},918:(e,n,t)=>{var o=t(379),c=t.n(o),a=t(279);c()(a.Z,{insert:"head",singleton:!1}),a.Z.locals}}]);