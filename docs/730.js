"use strict";(self.webpackChunkpk_connect=self.webpackChunkpk_connect||[]).push([[730],{730:(e,t,n)=>{n.r(t),n.d(t,{mountElement:()=>I});var o=n(271),c=n.n(o),r=n(650),s=n.n(r),a=n(577),i=n(985),u=n(861),l=n(885),h=n(757),d=n.n(h),m=n(788),p=n.n(m),k=n(379),f=n.n(k),v=n(279);f()(v.Z,{insert:"head",singleton:!1}),v.Z.locals;var g=n(191),b=n.n(g),S=n(671),E=n(144),Z=n(942),x=n(213),y=n.n(x),C=n(529),w=function(){function e(){(0,S.Z)(this,e),(0,Z.Z)(this,"isConnecting",!1),(0,Z.Z)(this,"socket",null),(0,Z.Z)(this,"user",{username:""}),(0,Z.Z)(this,"isAuthenticatedSubject",new C.BehaviorSubject(!1)),(0,Z.Z)(this,"isAuthenticated$",this.isAuthenticatedSubject.asObservable())}return(0,E.Z)(e,[{key:"isConnected",value:function(){return this.socket&&this.socket.connected||!1}},{key:"isAuthenticated",value:function(){return this.user&&this.user.username}},{key:"logout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{redirectToHomepage:!0};localStorage.removeItem("token"),this.user={},this.isAuthenticatedSubject.next(!1),e.redirectToHomepage&&(location.href="/")}},{key:"setUser",value:function(e){this.user=e,this.isAuthenticatedSubject.next(!0),this.socket&&this.socket.emit("updateUserInfo",{username:e.username})}},{key:"init",value:function(e){if(!this.isConnecting&&!this.socket){var t=localStorage.getItem("token"),n=t&&JSON.parse(t).value;this.socket=y()(e,{withCredentials:!0,transportOptions:{polling:{extraHeaders:{Authorization:"Bearer ".concat(n)}}}}),this.isConnecting=!0,this.socket.on("connect",this.onConnect)}}},{key:"onConnect",value:function(e){this.isConnecting=!1,console.log("connected")}}]),e}();const A=new w;function N(){var e=localStorage.getItem("token"),t=(0,o.useState)(e&&JSON.parse(e).value),n=(0,l.Z)(t,2),r=n[0],s=n[1],a=!1;return(0,o.useEffect)((0,u.Z)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,fetch("https://pk-center.herokuapp.com/auth/reconnect",{method:"POST",headers:{Authorization:"Bearer ".concat(r)}}).then((function(e){if(e.status>=400&&e.status<600)throw new Error("Bad response from server");return A.setUser(b()(r)),e})).catch((function(e){localStorage.removeItem("token"),s(null)}));case 4:case"end":return e.stop()}}),e)}))),[]),c().createElement(c().Fragment,null,r&&c().createElement("div",{className:"pkc-status"},"connected"),!r&&c().createElement("div",{className:"pkc-modal"},c().createElement("div",{className:"pkc-modal-overlay"}),c().createElement("div",{className:"pkc-modal-content"},c().createElement("button",{onClick:function(){a||(a=!0,fetch("https://pk-center.herokuapp.com/auth/guest",{method:"POST"}).then((function(e){return e.json()})).then((function(e){localStorage.setItem("token",JSON.stringify({value:e.access_token})),s(e.access_token),A.setUser(b()(e.access_token))})).finally((function(){a=!1})))}},"Play as guest"),c().createElement("button",{onClick:function(){location.href="https://pk.land/#/account/login"}},"Login PK account"))))}(0,a.Z)({seed:"pk-connect",productionPrefix:"pk-connect"});var O=p()({React:c(),ReactDOM:s(),rootComponent:N,errorBoundary:function(e,t,n){return c().createElement("div",null,"This renders when a catastrophic error occurs")}}),j=(O.bootstrap,O.mount,O.unmount,(0,a.Z)({productionPrefix:"pk-connect"}));const P=function(){return c().createElement("div",null,c().createElement(i.ZP,{generateClassName:j},c().createElement(N,null)))};var I=function(e){s().render(c().createElement(P,null),e)}},279:(e,t,n)=>{n.d(t,{Z:()=>a});var o=n(81),c=n.n(o),r=n(645),s=n.n(r)()(c());s.push([e.id,".pkc-status {\n  color: lime;\n}\n.pkc-modal {\n  position: fixed;\n  z-index: 500;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100vh;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.pkc-modal-overlay {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 0, 0, 0.7);\n}\n.pkc-modal-content {\n  z-index: 1;\n  width: 300px;\n  height: 200px;\n}\n",""]);const a=s}}]);