"use strict";(self.webpackChunkpk_connect=self.webpackChunkpk_connect||[]).push([[730],{730:(e,t,n)=>{n.r(t),n.d(t,{mountElement:()=>T});var o=n(271),c=n.n(o),r=n(650),a=n.n(r),s=n(577),i=n(985),u=n(861),l=n(885),h=n(757),m=n.n(h),p=n(788),k=n.n(p),d=n(379),f=n.n(d),g=n(279);f()(g.Z,{insert:"head",singleton:!1}),g.Z.locals;var v=n(191),E=n.n(v),y=n(671),C=n(144),Z=n(942),w=n(213),x=n.n(w),S=function(){function e(){(0,y.Z)(this,e),(0,Z.Z)(this,"isConnecting",!1),(0,Z.Z)(this,"socket",null),(0,Z.Z)(this,"user",{username:""})}return(0,C.Z)(e,[{key:"isConnected",value:function(){return this.socket&&this.socket.connected||!1}},{key:"isAuthenticated",value:function(){return this.user&&this.user.username}},{key:"logout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{redirectToHomepage:!0};localStorage.removeItem("token"),e.redirectToHomepage&&(location.href="/")}},{key:"setUser",value:function(e){this.user=e,this.socket&&this.socket.emit("updateUserInfo",{username:e.username})}},{key:"init",value:function(e){if(!this.isConnecting&&!this.socket){var t=localStorage.getItem("token"),n=t&&JSON.parse(t).value;this.socket=x()(e,{withCredentials:!0,transportOptions:{polling:{extraHeaders:{Authorization:"Bearer ".concat(n)}}}}),this.isConnecting=!0,this.socket.on("connect",this.onConnect)}}},{key:"onConnect",value:function(e){this.isConnecting=!1,console.log("connected")}}]),e}();const b=new S;function N(){var e=localStorage.getItem("token"),t=(0,o.useState)(e&&JSON.parse(e).value),n=(0,l.Z)(t,2),r=n[0],a=n[1],s=!1;return(0,o.useEffect)((0,u.Z)(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,fetch("https://pk-center.herokuapp.com/auth/reconnect",{method:"POST",headers:{Authorization:"Bearer ".concat(r)}}).then((function(e){if(e.status>=400&&e.status<600)throw new Error("Bad response from server");return b.setUser(E()(r)),e})).catch((function(e){localStorage.removeItem("token"),a(null)}));case 4:case"end":return e.stop()}}),e)}))),[]),c().createElement(c().Fragment,null,r&&c().createElement("div",{className:"pkc-status"},"connected"),!r&&c().createElement("div",{className:"pkc-modal"},c().createElement("div",{className:"pkc-modal-overlay"}),c().createElement("div",{className:"pkc-modal-content"},c().createElement("button",{onClick:function(){s||(s=!0,fetch("https://pk-center.herokuapp.com/auth/guest",{method:"POST"}).then((function(e){return e.json()})).then((function(e){localStorage.setItem("token",JSON.stringify({value:e.access_token})),a(e.access_token),b.setUser(E()(e.access_token))})).finally((function(){s=!1})))}},"Play as guest"),c().createElement("button",{onClick:function(){location.href="https://pk.land/#/account/login"}},"Login PK account"))))}(0,s.Z)({seed:"pk-connect",productionPrefix:"pk-connect"});var O=k()({React:c(),ReactDOM:a(),rootComponent:N,errorBoundary:function(e,t,n){return c().createElement("div",null,"This renders when a catastrophic error occurs")}}),P=(O.bootstrap,O.mount,O.unmount,(0,s.Z)({productionPrefix:"pk-connect"}));const I=function(){return c().createElement("div",null,c().createElement(i.ZP,{generateClassName:P},c().createElement(N,null)))};var T=function(e){a().render(c().createElement(I,null),e)}},279:(e,t,n)=>{n.d(t,{Z:()=>s});var o=n(81),c=n.n(o),r=n(645),a=n.n(r)()(c());a.push([e.id,".pkc-status {\n  color: lime;\n}\n.pkc-modal {\n  position: fixed;\n  z-index: 500;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100vh;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.pkc-modal-overlay {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 0, 0, 0.7);\n}\n.pkc-modal-content {\n  z-index: 1;\n  width: 300px;\n  height: 200px;\n}\n",""]);const s=a}}]);