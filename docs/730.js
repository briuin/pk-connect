"use strict";(self.webpackChunkpk_connect=self.webpackChunkpk_connect||[]).push([[730],{730:(e,n,t)=>{t.r(n),t.d(n,{mountElement:()=>_});var o=t(271),c=t.n(o),r=t(650),a=t.n(r),s=t(577),i=t(985),u=t(861),l=t(885),h=t(757),p=t.n(h),k=t(788),m=t.n(k),d=t(379),f=t.n(d),g=t(279);f()(g.Z,{insert:"head",singleton:!1}),g.Z.locals;var v=t(191),E=t.n(v),C=t(671),Z=t(144),w=t(942),x=t(213),y=t.n(x);const b=new(function(){function e(){(0,C.Z)(this,e),(0,w.Z)(this,"isConnecting",!1),(0,w.Z)(this,"socket",null),(0,w.Z)(this,"user",{username:""})}return(0,Z.Z)(e,[{key:"isConnected",value:function(){return this.socket&&this.socket.connected||!1}},{key:"setUser",value:function(e){this.user=e}},{key:"init",value:function(e){if(!this.isConnecting&&!this.socket){var n=localStorage.getItem("token"),t=n&&JSON.parse(n).value;this.socket=y()(e,{withCredentials:!0,transportOptions:{polling:{extraHeaders:{Authorization:"Bearer ".concat(t)}}}}),this.isConnecting=!0,this.socket.on("connect",this.onConnect)}}},{key:"onConnect",value:function(e){this.isConnecting=!1,console.log("connected")}}]),e}());function S(){var e=localStorage.getItem("token"),n=(0,o.useState)(e&&JSON.parse(e).value),t=(0,l.Z)(n,2),r=t[0],a=t[1],s=!1;return(0,o.useEffect)((0,u.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,fetch("https://pk-center.herokuapp.com/auth/reconnect",{method:"POST",headers:{Authorization:"Bearer ".concat(r)}}).then((function(e){if(e.status>=400&&e.status<600)throw new Error("Bad response from server");return b.setUser(E()(r)),e})).catch((function(e){localStorage.removeItem("token"),a(null)}));case 4:case"end":return e.stop()}}),e)}))),[]),c().createElement(c().Fragment,null,r&&c().createElement("div",{className:"pkc-status"},"connected"),!r&&c().createElement("div",{className:"pkc-modal"},c().createElement("div",{className:"pkc-modal-overlay"}),c().createElement("div",{className:"pkc-modal-content"},c().createElement("button",{onClick:function(){s||(s=!0,fetch("https://pk-center.herokuapp.com/auth/guest",{method:"POST"}).then((function(e){return e.json()})).then((function(e){localStorage.setItem("token",JSON.stringify({value:e.access_token})),a(e.access_token),b.setUser(E()(e.access_token))})).finally((function(){s=!1})))}},"Play as guest"),c().createElement("button",{onClick:function(){location.href="https://pk.land/#/account/login"}},"Login PK account"))))}(0,s.Z)({seed:"pk-connect",productionPrefix:"pk-connect"});var N=m()({React:c(),ReactDOM:a(),rootComponent:S,errorBoundary:function(e,n,t){return c().createElement("div",null,"This renders when a catastrophic error occurs")}}),O=(N.bootstrap,N.mount,N.unmount,(0,s.Z)({productionPrefix:"pk-connect"}));const P=function(){return c().createElement("div",null,c().createElement(i.ZP,{generateClassName:O},c().createElement(S,null)))};var _=function(e){a().render(c().createElement(P,null),e)}},279:(e,n,t)=>{t.d(n,{Z:()=>s});var o=t(81),c=t.n(o),r=t(645),a=t.n(r)()(c());a.push([e.id,".pkc-status {\n  color: lime;\n}\n.pkc-modal {\n  position: fixed;\n  z-index: 500;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100vh;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.pkc-modal-overlay {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 0, 0, 0.7);\n}\n.pkc-modal-content {\n  z-index: 1;\n  width: 300px;\n  height: 200px;\n}\n",""]);const s=a}}]);